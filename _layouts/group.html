---
layout: main
css: ../stylesheets/stylesheet.css
---
<h1><a name="h.jkvseqok3de"></a><span>Deploy an application with &ldquo;Elastic Beanstalk&rdquo;</span></h1><p><span></span></p><p><img src="images/image00.png"></p><p><span></span></p><p><span></span></p><p><span>Prerequisites: </span></p><ol start="1"><li><span>AWS command line tools (</span><span><a href="http://www.google.com/url?q=http%3A%2F%2Fdocs.amazonwebservices.com%2Felasticbeanstalk%2Flatest%2Fdg%2FusingCLI.html&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHAC166mLlXA1Ezxv5Xz_OctjR-BQ">Help here</a></span><span>) </span></li><li><span>Download the 2 versions of petclinic required for this work</span></li></ol><ol start="1"><li><span><a href="https://s3-eu-west-1.amazonaws.com/workshop-aws-beanstalk/petclinic-1.0.war">petclinic-1.0.war</a></span></li><li><span><a href="https://s3-eu-west-1.amazonaws.com/workshop-aws-beanstalk/petclinic-2.0.war">petclinic-2.0.war</a></span></li></ol><p><a name="h.c5evxmlvaws0"></a><span>1 - Deploy with AWS Web Console</span></p><h2><a name="h.z9jik6tm9217"></a><span>1.1 - Connect to AWS console</span></h2><p><span>The AWS cons</span><span>ole is here: </span><span><a href="https://xebia-france.signin.aws.amazon.com/console">https://xebia-france.signin.aws.amazon.com/console</a></span></p><p><span></span></p><p><span>Login: {{page.groupId}}</span></p><p><span>Password: &lt;&lt;Written on your worksheet&gt;&gt;</span></p><h2><a name="h.wqqlorlisphh"></a><span>1.2 - Create a new application from sample</span></h2><p><span>When logged, you arrive on AWS Management Console homepage and click on &ldquo;Elastic Beanstalk&rdquo; :</span></p><p><img src="images/image13.png"></p><p><span></span></p><p><span>Then, once in the Elastic Beanstalk console, change your region to </span><span>EU (Ireland)</span><span>:</span></p><p><span></span></p><p><img src="images/image27.png"></p><h3><a name="h.rb0ok5ub3ik5"></a><span>Application Details</span></h3><p><span>Create a new application by following the next steps:</span></p><p><img src="images/image18.png"></p><ol start="1"><li><span>Click on &ldquo;Create New Application&rdquo;.</span></li><li><span>In the modal window provide the &ldquo;Application-Name&rdquo; type &lsquo;petclinic-{{ page.groupId }}&rsquo;</span></li><li><span>Select &ldquo;Container Type&rdquo; : &ldquo;64bit Amazon Linux running Tomcat 7&rdquo;</span></li><li><span>Select &ldquo;Application Source&rdquo; : &ldquo;Use the Sample Application&rdquo;.</span></li><li><span>Click on &ldquo;Continue&rdquo;</span></li></ol><h3><a name="h.usth3u9db3a7"></a><span>Environment Details</span></h3><p><img src="images/image15.png"></p><ol start="1"><li><span>Check &ldquo;Launch a new environment running this application&rdquo; and &ldquo;Create an RDS DB Instance with this environment&rdquo;</span></li><li><span>Provide the &ldquo;Environment Name&rdquo; : petclinic-{{ page.groupId }}-dev</span></li><li><span>Provide an environment url (this will be your application url) and check availability</span></li></ol><h3><a name="h.45fzqq6tiywn"></a><span>Configuration Details (Step 1)</span></h3><p><img src="images/image08.png"></p><ol start="1"><li><span>Choose t1.micro</span></li><li><span>Enter &ldquo;/&rdquo; as application health check URL</span></li></ol><p><span></span></p><p><span></span></p><h3><a name="h.nag9sc7xa39f"></a><span>Configuration Details (Step 2)</span></h3><p><img src="images/image02.png"></p><ol start="1"><li><span>Choose the petclinic snapshot (with the petclinic schema already created)</span></li><li><span>Enter the username root and the password rootroot</span></li></ol><p><span></span></p><p><span></span></p><p><img src="images/image29.png"></p><p><span></span></p><p><span></span></p><p><img src="images/image14.png"></p><p><span></span></p><p><img src="images/image24.png"></p><h3><a name="h.p4oik7rglm9d"></a><span>Test sample application</span></h3><p><span>Once the Beanstalk test application environment is green (it may take about 15 minutes) then you should have the following screen</span></p><p><img src="images/image09.png"></p><p><span>Click on the &ldquo;View Running Version&rdquo; to see your first application deployed on Beanstalk:</span></p><p><img src="images/image20.png"></p><h2><a name="h.sk9s7lt50pi7"></a><span>1.3 - Deploy PetClinic application in place of the sample application</span></h2><h3><a name="h.4bc78sun57vu"></a><span>Upload the Petclinic war file</span></h3><ol start="1"><li><span>Click on Versions tab</span></li><li><span>Click on New Version</span></li><li><span>Name your version petclinic-{{page.groupId}}-1.0</span></li><li><span>Upload petclinic-1.0.war</span></li></ol><p><img src="images/image16.png"></p><p><span></span></p><p><span>Testing the PetClinic application</span></p><p><span></span></p><p><img src="images/image21.png"></p><p><span></span></p><hr style="page-break-before:always;display:none;"><p><span></span></p><h1><a name="h.swramvdjbfer"></a><span>2 - Deploy with CLI</span></h1><h2><a name="h.tfppc8ddp1oz"></a><span>2.1 - SDK CLI installation</span></h2><p><span>Download AWS command line tools (</span><span><a href="http://docs.amazonwebservices.com/elasticbeanstalk/latest/dg/usingCLI.html">Help here</a></span><span>) </span></p><p><span></span></p><p><span>If you have any error with JSON during command execution, execute</span></p><p><span></span></p><a href="#" name="6820246b598c148fd7634922a5578b76730d0abe"></a><a href="#" name="0"></a><table cellpadding="0" cellspacing="0"><tbody><tr><td><p><span>$sudo gem install json</span></p></td></tr></tbody></table><p><span></span></p><hr style="page-break-before:always;display:none;"><p><span></span></p><h2><a name="h.4ek4pdpjcvyr"></a><span>2.2 - Deploy a new version</span></h2><h3><a name="h.cvd5wvt7lkf8"></a><span>Upload your application version stored in S3 bucket in your Team-application</span></h3><a href="#" name="f4a99b172ca0afe2c8c1029b4efec830719724c4"></a><a href="#" name="1"></a><table cellpadding="0" cellspacing="0"><tbody><tr><td><p><span>$ elastic-beanstalk-create-application-version -a petclinic-{{page.groupId}} -l &#39;petclinic-{{page.groupId}}-1.0&#39; -d &#39;Petclinic application production&#39; -s workshop-aws-beanstalk/V1/petclinic.war</span></p></td></tr></tbody></table><p><span></span></p><p><img src="images/image25.png"></p><p><span></span></p><h3><a name="h.uklklhgs2oz8"></a><span>Check your environment informations</span></h3><a href="#" name="176ed9e280998282bf392dbbca22359ef5f8b7f0"></a><a href="#" name="2"></a><table cellpadding="0" cellspacing="0"><tbody><tr><td><p><span>$ elastic-beanstalk-describe-environments -a petclinic-{{page.groupId}}</span></p></td></tr></tbody></table><p><span>You need to retrieve your environment id.</span></p><p><span></span></p><p><img src="images/image04.png"></p><h3><a name="h.fwumo0armi5s"></a><span>Create a template configuration of your first environment named myConfig</span></h3><a href="#" name="e30aee449366aea628ef8b9d22ad1bcaebc95109"></a><a href="#" name="3"></a><table cellpadding="0" cellspacing="0"><tbody><tr><td><p><span>$ elastic-beanstalk-create-configuration-template -a petclinic-{{page.groupId}} -t petclinic-{{page.groupId}}-config -E [environmentId]</span></p></td></tr></tbody></table><h3><a name="h.uxpcnv86ov9y"></a></h3><p><span></span></p><h3><a name="h.6zcq2h1vfzt1"></a><span>Now you can create a new environment with your file template configuration</span></h3><a href="#" name="3e9f6330dad5d806cbfb07771f978570ecfb62df"></a><a href="#" name="4"></a><table cellpadding="0" cellspacing="0"><tbody><tr><td><p><span>$ elastic-beanstalk-create-environment -a petclinic-{{page.groupId}} -l &#39;petclinic-{{page.groupId}}-1.0&#39; -d &#39;Petclinic application prod&#39; -e petclinic-{{page.groupId}}-prod -t petclinic-{{page.groupId}}-config</span></p></td></tr></tbody></table><p><span></span></p><p><img src="images/image03.png"></p><p><span>You have now two configured environments:</span></p><p><span></span></p><p><img src="images/image07.png"></p><p><span></span></p><h1><a name="h.map0mpz4dp22"></a><span>3 - </span><span>Blue/Green Deployment</span></h1><p><span>One of the challenges with automating deployment is the cut-over itself, taking software from the final stage of testing to live production. You usually need to do this quickly in order to minimize downtime.</span></p><p><span></span></p><p><img src="images/image10.png"></p><p><span>The blue-green deployment approach does this by ensuring you have two production environments, as identical as possible. At any time one of them, let&#39;s say blue for the example, is live. As you prepare a new release of your software you do your final stage of testing in the green environment. Once the software is working in the green environment, you switch the router so that all incoming requests go to the green environment - the blue one is now idle.</span></p><h2><a name="h.a95rdu26denp"></a><span>3.1 - Saving your prod environment configuration settings</span></h2><p><span></span></p><p><span>Below the application selection drop-down list, click the </span><span>Actions</span><span>&nbsp;drop-down list for your application environment in the application&#39;s Environments list and select </span><span>Save Configuration</span><span>.</span></p><p><span></span></p><p><img src="images/image31.png"></p><p><span></span></p><p><span>In the </span><span>Configuration Name</span><span>&nbsp;field type </span><span>petclinic-configuration-{{page.groupId}}</span><span>&nbsp;and click </span><span>Save Config</span><span>.</span></p><p><span></span></p><p><img src="images/image23.png"></p><h2><a name="h.yg784ymilwry"></a><span>3.2 - Upload the new application version</span></h2><p><span>Go to the </span><span>Versions</span><span>&nbsp;tab, and click </span><span>Upload New Version</span><span>. In the pop-up windows, indicate </span><span>petclinic-{{page.groupId}}-2.0 </span><span>in the </span><span>Version Label</span><span>&nbsp;field and upload the new version of your application.</span></p><p><span></span></p><p><span>Do not forget to check the deployment option </span><span>Upload but do not deploy to any environment</span><span>, and then click </span><span>Upload New Version</span><span>&nbsp;and upload petclinic-2.0.war</span></p><p><span></span></p><p><img src="images/image17.png"></p><p><span></span></p><p><span>Now, verify that your new application version has been correctly uploaded.</span></p><p><span></span></p><p><img src="images/image26.png"></p><h2><a name="h.9vs3tfaz8kwa"></a><span>3.3 - Create a new QA environment</span></h2><p><span>Click </span><span>Launch New Environment</span><span>&nbsp;button and fill the form with </span><span>petclinic-{{page.groupId}}-qa</span><span>&nbsp;as environment name. Indicate that you want to use an existing application version and select </span><span>Second Release.</span></p><p><span></span></p><p><span>In the Container Type, indicate </span><span>64bit Amazon Linux running Tomcat 7</span><span>&nbsp;and check the </span><span>Create an RDS DB Instance with this environment</span><span>&nbsp;option.</span></p><p><span></span></p><p><span>Then click </span><span>Continue.</span></p><p><span></span></p><p><img src="images/image05.png"></p><p><span></span></p><p><span>On the next step, indicate that you want to </span><span>Load a Saved Configuration</span><span>&nbsp;by selecting the </span><span>petclinic-configuration-{{page.groupId}}</span><span>&nbsp;configuration, and click </span><span>Continue</span><span>.</span></p><p><span></span></p><p><img src="images/image28.png"></p><p><span></span></p><p><span>Concerning the </span><span>RDS DB Instance</span><span>, indicate that you want to create it from a snaphot and select </span><span>petclinic-database-created-snapshot</span><span>.</span></p><p><span></span></p><p><span>Fill </span><span>rootroot</span><span>&nbsp;as master password, and click </span><span>Continue</span><span>.</span></p><p><span></span></p><p><img src="images/image12.png"></p><p><span></span></p><p><span>Verify your environment information and click </span><span>Finish</span><span>.</span></p><p><span></span></p><p><img src="images/image19.png"></p><h2><a name="h.b3fpwc2c9p72"></a><span>3.4 - Deploy the new application version with Zero Downtime</span></h2><p><span>Now, you have 2 environments:</span></p><ol start="1"><li><span>QA (Blue Slice)</span></li><li><span>PRD (Green Slice)</span></li></ol><p><span></span></p><p><span>Make sure that your new environment is in the Green and Ready state.</span></p><p><span></span></p><p><img src="images/image30.png"></p><p><span></span></p><p><span>Click the </span><span>Actions</span><span>&nbsp;drop-down list on your live production application environment and select </span><span>Swap Environment URL</span><span>.</span></p><p><span></span></p><p><img src="images/image01.png"></p><p><span></span></p><p><span>In the </span><span>Swap Environment URL</span><span>&nbsp;window, select </span><span>petclinic-{{page.groupId}}-qa</span><span>&nbsp;from the </span><span>Environment Name</span><span>&nbsp;pull-down menu, and then click on </span><span>Swap URL</span><span>.</span></p><p><span></span></p><p><img src="images/image06.png"></p><p><span></span></p><p><span>Now the new release version of your application is accessible through the URL of your live production environment: </span><span>http://petclinic-{{page.groupId}}.elasticbeanstalk.com/</span><span>.</span></p><p><span></span></p><p><img src="images/image22.png"></p><p><span></span></p><p><span>Enjoy!</span></p><p><span></span></p><p><img src="images/image11.png"></p>