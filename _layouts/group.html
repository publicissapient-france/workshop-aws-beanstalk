---
layout: main
css: ../stylesheets/stylesheet.css
---

<style type="text/css">ol{margin:0;padding:0}.c9{vertical-align:top;width:468pt;border-style:solid;background-color:#cccccc;border-color:#000000;border-width:1pt;padding:5pt 5pt 5pt 5pt}.c23{vertical-align:top;width:468pt;border-style:solid;border-color:#000000;border-width:1pt;padding:5pt 5pt 5pt 5pt}.c11{list-style-type:disc;margin:0;padding:0}.c14{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c22{color:#333333;font-size:12pt;background-color:#ffffff}.c2{color:#1155cc;text-decoration:underline}.c5{color:inherit;text-decoration:inherit}.c0{direction:ltr;margin-left:54pt}.c21{color:#666666;font-size:12pt}.c7{background-color:#d9d9d9}.c6{margin-left:36pt}.c19{height:0pt}.c4{font-weight:bold}.c12{margin-left:18pt}.c15{font-style:italic}.c17{text-decoration:underline}.c1{direction:ltr}.c13{line-height:1.0}.c8{border-collapse:collapse}.c16{text-align:center}.c18{height:12pt}.c10{padding-left:0pt}.c3{height:11pt}.c20{color:#ff0000}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:10pt;font-family:"Arial";padding-bottom:2pt}</style></head><body class="c14"><p class="c1 c3"><span></span></p><p class="c12 c1"><span class="c2"><a class="c5" href="#h.6cwv4882r8jw">Deploy an application with &ldquo;Elastic Beanstalk&rdquo;</a></span></p><p class="c1 c6"><span class="c2"><a class="c5" href="#h.z9jik6tm9217">Connect to AWS console</a></span></p><p class="c6 c1"><span class="c2"><a class="c5" href="#h.wqqlorlisphh">Create a new sample application</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.585r3gk5nn3r">Application Details</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.ehxc748ma7ut">Environment Details (Option A : create a DB Instance with the environment)</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.oihsar43ahn">Configuration Details</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.e47dwwh7ad9j">*</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.4s1tdstotjhd">TODO</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.v6v5ysgci6qz">Configuration Details (Option A : Create the DB from a snapshot)</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.p4oik7rglm9d">Test sample application</a></span></p><p class="c6 c1"><span class="c2"><a class="c5" href="#h.sk9s7lt50pi7">Deploy PetClinic application in place of the sample application</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.l1qkrd74dlrp">Upload the Petclinic war file</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.7xfsqqrlwcbe">Providing url to the MySQL instance</a></span></p><p class="c6 c1"><span class="c2"><a class="c5" href="#h.gu96gf1l6g8u">Deploying Petclinic when we do not provide a RDS DB snapshot</a></span></p><p class="c1 c12"><span class="c2"><a class="c5" href="#h.zg3zc1e7x3nf">SDK CLI installation</a></span></p><p class="c12 c1"><span class="c2"><a class="c5" href="#h.kcmccid8htd3">Deploy a new application</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.8apxffk384ms">Create a new application slot</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.7b6tawoffmy6">Deploy on your new slot, your application stored in a S3 bucket</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.yax76l4hkcea">Set your options</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.eomlai7lxvng">Create your environment</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.w1opupd5ilri">Create your RDS</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.w7g95l63tin">Terminate your environment</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.c11y3td4qqi">Delete your environment</a></span></p><p class="c0"><span class="c2"><a class="c5" href="#h.ctddoeui2bjm">Delete your application</a></span></p><p class="c12 c1"><span class="c2"><a class="c5" href="#h.91xu7klkeht6">Part 3 - Blue/Green Deployment</a></span></p><p class="c6 c1"><span class="c2"><a class="c5" href="#h.a95rdu26denp">Saving your PRD environment configuration settings</a></span></p><p class="c6 c1"><span class="c2"><a class="c5" href="#h.yg784ymilwry">Upload the new application version</a></span></p><p class="c6 c1"><span class="c2"><a class="c5" href="#h.9vs3tfaz8kwa">Create a new QA environment</a></span></p><p class="c6 c1"><span class="c2"><a class="c5" href="#h.o8ngkqtmn4dx">Deploy the new application version with Zero Downtime</a></span></p><p class="c1 c3"><span></span></p><h1 class="c1"><a name="h.6cwv4882r8jw"></a><span>Deploy an application with &ldquo;Elastic Beanstalk&rdquo;</span></h1><p class="c1"><span>Pr&eacute;requis: </span></p><p class="c1"><span>JDK6</span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c3"><span></span></p><h2 class="c1"><a name="h.z9jik6tm9217"></a><span>Connect to AWS console</span></h2><p class="c1"><span>The AWS console is here: </span><span class="c2"><a class="c5" href="https://xebia-france.signin.aws.amazon.com/console">https://xebia-france.signin.aws.amazon.com/console</a></span></p><p class="c1 c3"><span></span></p><p class="c1"><span>The login and password are the one provided on the workshop sheet on the table.</span></p><p class="c1 c3"><span></span></p><p class="c1"><span>TODO: s&eacute;lectioner Ireland</span></p><h2 class="c1"><a name="h.wqqlorlisphh"></a><span>Create a new sample application</span></h2><p class="c1"><span>Go to Amazon Console home page and click on &ldquo;Elastic Beanstalk&rdquo; :</span></p><p class="c1"><img height="413" src="images/image04.png" width="677"></p><p class="c1 c3"><span></span></p><h3 class="c1"><a name="h.585r3gk5nn3r"></a><span>Application Details</span></h3><p class="c1"><span>Click on &ldquo;Create New Application&rdquo;.</span></p><p class="c1"><span>Then in the modal window provide the &ldquo;Application-Name&rdquo; type &lsquo;petclinic-{{ page.groupId }}&rsquo;</span></p><p class="c1"><span>Select &ldquo;Container Type&rdquo; : &ldquo;64bit Amazon Linux running Tomcat 7&rdquo;</span></p><p class="c1"><span>Select &ldquo;Application Source&rdquo; : &ldquo;Use the Sample Application&rdquo;.</span></p><p class="c1"><span>Click on &ldquo;Continue&rdquo;</span></p><p class="c1"><img height="389" src="images/image09.png" width="697"></p><p class="c1"><span>TODO: il manque le screenshot suivant o&ugrave; on peut mettre la taille de l&rsquo;instance, exisiting key pair</span></p><hr style="page-break-before:always;display:none;"><p class="c1 c3"><span></span></p><h3 class="c1"><a name="h.ehxc748ma7ut"></a><span>Environment Details (Option A : create a DB Instance with the environment)</span></h3><p class="c1"><span>Check &nbsp;&ldquo;Launch a new environment running this application&rdquo; and &ldquo;Create an RDS DB Instance with this environment&rdquo;.</span></p><p class="c1"><span>Provide the &ldquo;Environment Name&rdquo; : petclinic-{{ page.groupId }}-DEV</span></p><p class="c1"><span>Provide an environment url (this will be your application url).</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="441" src="images/image22.png" width="635"></p><p class="c1 c3"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c3"><span></span></p><h3 class="c1"><a name="h.oihsar43ahn"></a><span>Configuration Details</span></h3><h3 class="c1"><a name="h.e47dwwh7ad9j"></a><img height="389" src="images/image19.png" width="617"></h3><h3 class="c1"><a name="h.4s1tdstotjhd"></a><span>TODO</span></h3><h3 class="c1"><a name="h.v6v5ysgci6qz"></a><span>Configuration Details (Option A : Create the DB from a snapshot)</span></h3><p class="c1 c3"><span></span></p><p class="c1"><img height="503" src="images/image41.png" width="590"></p><p class="c1 c3"><span></span></p><p class="c1 c16"><img height="412" src="images/image20.png" width="482"></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c16"><img height="115" src="images/image31.png" width="441"></p><p class="c1 c3"><span></span></p><p class="c1"><img height="375" src="images/image16.png" width="697"></p><p class="c1 c3"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c3"><span></span></p><h3 class="c1"><a name="h.p4oik7rglm9d"></a><span>Test sample application</span></h3><p class="c1"><span>Once the Beanstalk test application environment is up then you should have the following screen</span></p><p class="c1"><img height="297" src="images/image27.png" width="660"></p><p class="c1"><span>Click on the &ldquo;View Running Version&rdquo; to see your first application deployed on Beanstalk:</span></p><p class="c1"><img height="403" src="images/image35.png" width="640"></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><h2 class="c1"><a name="h.sk9s7lt50pi7"></a><span>Deploy PetClinic application in place of the sample application</span></h2><h3 class="c1"><a name="h.l1qkrd74dlrp"></a><span>Upload the Petclinic war file</span></h3><p class="c1"><img height="485" src="images/image05.png" width="668"></p><p class="c1 c3"><span></span></p><p class="c1"><span>Testing the PetClinic application</span></p><p class="c1"><span>Well it doesn&rsquo;t work well right now &hellip;</span></p><p class="c1"><span>We should take a look to the logs files</span></p><p class="c1"><img height="249" src="images/image42.png" width="676"></p><p class="c1"><span>Looking a the detail to the log we ca find out that the database is not found.</span></p><p class="c1"><span>We need to provide the url of the RDS MySQL database instance to our PetClinic application.</span></p><p class="c1"><img height="296" src="images/image21.png" width="769"></p><p class="c1 c3"><span></span></p><h3 class="c1 c18"><a name="h.23ltab9fxfi1"></a></h3><hr style="page-break-before:always;display:none;"><h3 class="c1 c18"><a name="h.wr52sn91che9"></a></h3><h3 class="c1"><a name="h.7xfsqqrlwcbe"></a><span>Providing url to the MySQL instance</span></h3><p class="c1"><span>Before providing the url to our application we need to know the DB Endpoint url. </span></p><p class="c1"><span>Select the url and copy it in the clipboard.</span></p><p class="c1"><img height="434" src="images/image03.png" width="685"></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c3"><span></span></p><p class="c1"><span>Provide the jdbc connection string. For example:</span></p><p class="c1"><span>jdbc:mysql://</span><span class="c4 c15">aar34zgkhl2dcm.cccb4ickfoh9.eu-west-1.rds.amazonaws.com</span><span>:3306/petclinic?user=root&amp;password=rootroot</span></p><p class="c1"><span>Obviously for your own petclinic application you should set your own DB Endpoint with the one you&rsquo;ve copied previously.</span></p><p class="c1"><span>When you&rsquo;ve provided the url in the JDBC_CONNECTION_STRING environment variable, click on &ldquo;Apply Changes&rdquo;.</span></p><p class="c1"><img height="449" src="images/image11.png" width="555"></p><p class="c1 c3"><span></span></p><p class="c1"><span>When the environment has finished restarted, check again the petclinic application. </span></p><hr style="page-break-before:always;display:none;"><p class="c1 c3"><span></span></p><h2 class="c1"><a name="h.gu96gf1l6g8u"></a><span>Deploying Petclinic when we do not provide a RDS DB snapshot</span></h2><p class="c1"><span>Now we are going to deploy the petclinic application with a mysql database.</span></p><p class="c1"><img height="296" src="images/image37.png" width="660"></p><p class="c1"><span>Click on &ldquo;Edit Configuration&rdquo; and select &ldquo;Database&rdquo; Tab</span></p><p class="c1"><img height="546" src="images/image29.png" width="531"></p><p class="c1 c3"><span></span></p><p class="c1"><span>Check &ldquo;Create an RDS DB Instance with this environment&rdquo;</span></p><p class="c1"><span>Provide the following configuration:</span></p><p class="c1"><span>Allocated Storage: 5 GB</span></p><p class="c1"><span>Master Username: root</span></p><p class="c1"><span>Master Password: rootroot</span></p><p class="c1"><img height="576" src="images/image07.png" width="561"></p><p class="c1"><span>Once done click on &ldquo;Apply Changes&rdquo;.</span></p><p class="c1 c3"><span></span></p><p class="c1"><span>When the RDS DB Instance is up click again on &ldquo;Edit Configuration&rdquo; and select the &ldquo;Database&rdquo; tab:</span></p><p class="c1"><img height="518" src="images/image30.png" width="545"></p><p class="c1 c3"><span></span></p><p class="c1"><span>Remember the &ldquo;DB Endpoint&rdquo;.</span></p><p class="c1"><span>Click Cancel to close &ldquo;Edit Configuration&rdquo; modal window.</span></p><p class="c1 c3"><span></span></p><p class="c1"><span>Now go to RDS management console. Click on &ldquo;Console&rdquo; and choose &ldquo;RDS&rdquo;:</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="250" src="images/image34.png" width="300"></p><p class="c1 c3"><span></span></p><p class="c1"><span>In the RDS Console click on &ldquo;DB Instances</span></p><p class="c1"><img height="263" src="images/image08.png" width="676"></p><p class="c1 c3"><span></span></p><p class="c1"><span>This will display the current active DB instances:</span></p><p class="c1"><img height="122" src="images/image45.png" width="673"></p><p class="c1"><span>If there is more than one you will need to use the name of the &ldquo;DB Endpoint&rdquo; you previously set aside and you will get the name of the &ldquo;Security Group&rdquo; linked to the DB Instance.</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="378" src="images/image25.png" width="649"></p><p class="c1 c3"><span></span></p><p class="c1"><img height="251" src="images/image12.png" width="708"></p><p class="c1 c3"><span></span></p><p class="c1"><img height="264" src="images/image33.png" width="693"></p><p class="c1 c3"><span></span></p><p class="c1"><span>With your mysql client from your computer connect to the RDS Database :</span></p><p class="c1"><img height="336" src="images/image14.png" width="559"></p><p class="c1 c3"><span></span></p><p class="c1"><span>One you are connected to the distant RDS MySQL Instance you can create the &ldquo;petclinic&rdquo; database:</span></p><p class="c1 c3"><span></span></p><p class="c1"><span>create database petclinic;</span></p><p class="c1 c3"><span></span></p><p class="c1"><span>Now that we have created the database in the RDS MySQL Instance we have to close the access we previously opened. </span></p><p class="c1"><span>To do that we remove &ldquo;CIDR/IP&rdquo; &ldquo;Connection Type&rdquo; by clicking on the &ldquo;Remove&rdquo; button.</span></p><p class="c1"><span>Finally click on &ldquo;Refresh Security groups&rdquo;</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="264" src="images/image36.png" width="693"></p><p class="c1 c3"><span></span></p><p class="c1"><span>Return on the Beanstalk instance:</span></p><p class="c1"><img height="261" src="images/image40.png" width="694"></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1"><span>We are going to provide the JDBC url to our application using a system property named JDBC_CONNECTION_STRING.</span></p><p class="c1"><span>The url should be of the form:</span></p><p class="c1"><span>jdbc:mysql://</span><span class="c4">aa1eh8jwqqq5ght.cccb4ickfoh9.eu-west-1.rds.amazonaws.com</span><span>:3306/petclinic?user=root&amp;password=rootroot</span></p><p class="c1"><span>The bold string should be replaced by </span><span class="c17">your own</span><span>&nbsp;RDS mySQL instance.</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="384" src="images/image00.png" width="692"></p><p class="c1 c3"><span></span></p><p class="c1"><span>Beanstalk is going to restart the tomcat server with the system property properly set.</span></p><p class="c1"><span>Once restart is done select the &ldquo;Versions&rdquo; tab, </span></p><p class="c1"><span>Click on &ldquo;Upload New Version&rdquo; and </span></p><ol class="c11" start="1"><li class="c6 c1 c10"><span>set the form with version label, </span></li><li class="c6 c1 c10"><span>upload the war file, </span></li><li class="c6 c1 c10"><span>select &ldquo;Deploy to an existing environment after upload&rdquo;, </span></li><li class="c6 c1 c10"><span>choose &ldquo;Default-Environment&rdquo;, </span></li><li class="c6 c1 c10"><span>validate by clicking on &ldquo;Apply Changes&rdquo;</span></li></ol><p class="c1 c3"><span></span></p><p class="c1"><span>Now Tomcat instance is restarted.</span></p><p class="c1"><img height="426" src="images/image17.png" width="697"></p><p class="c1 c3"><span></span></p><p class="c1"><span>When Tomcat is up with our new war file click on &ldquo;View Running Version&rdquo; and use the petclinic web app to check database access works fine.</span></p><p class="c1"><img height="345" src="images/image10.png" width="697"></p><p class="c1 c3"><span></span></p><p class="c1"><img height="450" src="images/image13.png" width="643"></p><p class="c1 c3"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c3"><span></span></p><h1 class="c1"><a name="h.zg3zc1e7x3nf"></a><span>SDK CLI installation</span></h1><p class="c1"><span>Download Elastic Beanstalk Command Line Tool at URL </span><span class="c2"><a class="c5" href="http://aws.amazon.com/code/6752709412171743">http://aws.amazon.com/code/6752709412171743</a></span></p><p class="c1 c3"><span></span></p><p class="c1"><span>Unzip the archive in the &lt;workshop_directory&gt;.</span></p><p class="c1"><span>Add the directory &lt;workshop_directory&gt;/AWS-ElasticBeanstalk-CLI-2.2/api/bin to your PATH.</span></p><p class="c1"><span>In your &lt;workshop_directory&gt; create a file named credentials and write the following lines:</span></p><p class="c1"><span>AWSAccessKeyId=</span><span class="c15">Write your AWS access ID</span><span><br>AWSSecretKey=</span><span class="c15">Write your AWS secret key</span></p><p class="c1"><span>(check your mails for the values)</span></p><p class="c1 c3"><span></span></p><p class="c1"><span>Add the environment variables:</span></p><p class="c1"><span>export AWS_CREDENTIAL_FILE=&lt;workshop_directory&gt;/credentials</span></p><p class="c1"><span>export ELASTICBEANSTALK_URL=https://elasticbeanstalk.eu-west-1.amazonaws.com</span></p><p class="c1 c3"><span></span></p><p class="c1"><span>Si erreurs avec JSon lors de l&rsquo;&eacute;xecution des commandes:</span></p><p class="c1 c3"><span class="c7"></span></p><a href="#" name="6820246b598c148fd7634922a5578b76730d0abe"></a><a href="#" name="0"></a><table cellpadding="0" cellspacing="0" class="c8"><tbody><tr><td class="c7 c23"><p class="c1 c13"><span class="c7">$sudo gem install json</span></p></td></tr></tbody></table><p class="c1 c3"><span class="c7"></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1"><span>source:</span></p><p class="c1"><span class="c2"><a class="c5" href="http://docs.amazonwebservices.com/elasticbeanstalk/latest/dg/usingCLI.html">http://docs.amazonwebservices.com/elasticbeanstalk/latest/dg/usingCLI.html</a></span></p><p class="c1 c3"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c3"><span></span></p><h1 class="c1"><a name="h.kcmccid8htd3"></a><span>Deploy a new application</span></h1><h3 class="c1"><a name="h.8apxffk384ms"></a><span>Create a new application slot</span></h3><p class="c1 c3"><span></span></p><a href="#" name="57f7db5caa03b14d46e2d784f80528f8f2542b83"></a><a href="#" name="1"></a><table cellpadding="0" cellspacing="0" class="c8"><tbody><tr class="c19"><td class="c9"><p class="c1 c13"><span>$ elastic-beanstalk-create-application -a &#39;GEG-WorkshopApplication&#39;</span></p></td></tr></tbody></table><h3 class="c1"><a name="h.7b6tawoffmy6"></a><span>Deploy on your new slot, your application stored in a S3 bucket</span></h3><a href="#" name="bcf7692c27e1dd18a474eb80a4d35cf223cc3245"></a><a href="#" name="2"></a><table cellpadding="0" cellspacing="0" class="c8"><tbody><tr><td class="c9"><p class="c1 c13"><span>$ elastic-beanstalk-create-application-version -a GEG-WorkshopApplication -l &#39;V1&#39; -d &#39;Test CLI&#39; -s elasticbeanstalk-eu-west-1-010154155802/2012322ige-petclinic.war</span></p></td></tr></tbody></table><p class="c1 c3"><span></span></p><p class="c1"><span>=&gt; Your application must be uploaded on a S3 bucket before you can launched it with beanstalk.</span></p><h3 class="c1"><a name="h.yax76l4hkcea"></a><span>Set your options</span></h3><p class="c1"><span>Create a file named </span><span class="c4">deploymentOptions.txt</span><span>&nbsp;</span></p><p class="c1"><span>Copy and paste in </span><span class="c4">deploymentOptions.txt</span><span>&nbsp;the following content :</span></p><a href="#" name="cf194fc3354bb295846cf22f119e08b608ebd62b"></a><a href="#" name="3"></a><table cellpadding="0" cellspacing="0" class="c8"><tbody><tr class="c19"><td class="c9"><p class="c1 c13"><span>[</span></p><p class="c1 c13"><span>&nbsp; {&quot;Namespace&quot;: &quot;aws:autoscaling:asg&quot;,</span></p><p class="c1 c13"><span>&nbsp; &nbsp;&quot;OptionName&quot;: &quot;MinSize&quot;,</span></p><p class="c1 c13"><span>&nbsp; &nbsp;&quot;Value&quot;: &quot;1&quot;},</span></p><p class="c1 c13"><span>&nbsp; {&quot;Namespace&quot;: &quot;aws:autoscaling:asg&quot;,</span></p><p class="c1 c13"><span>&nbsp; &nbsp;&quot;OptionName&quot;: &quot;MaxSize&quot;,</span></p><p class="c1 c13"><span>&nbsp; &nbsp;&quot;Value&quot;: &quot;3&quot;}</span></p><p class="c1 c13"><span>]</span></p></td></tr></tbody></table><p class="c1 c3"><span class="c4 c21"></span></p><p class="c1"><span>This will be used </span><span>to set the options of your environment.</span></p><p class="c1"><span>If you want t</span><span>o see the available options, follow this url: </span><span class="c2"><a class="c5" href="http://docs.amazonwebservices.com/elasticbeanstalk/latest/dg/command-options.html">http://docs.amazonwebservices.com/elasticbeanstalk/latest/dg/command-options.html</a></span></p><h3 class="c1"><a name="h.eomlai7lxvng"></a><span>Create your environment</span></h3><a href="#" name="467160f2b8b70d4364e6a60b5e817c8ddbbe177f"></a><a href="#" name="4"></a><table cellpadding="0" cellspacing="0" class="c8"><tbody><tr class="c19"><td class="c9"><p class="c1"><span>$ elastic-beanstalk-create-environment -a GEG-WorkshopApplication -e UAT-environment -s &#39;64bit Amazon Linux running Tomcat 7&#39; -f ~/Xebia/Workshop/AtelierBeanstalk/deploymentOptions.txt </span></p></td></tr></tbody></table><p class="c1"><span>=&gt; $ elastic-beanstalk-list-available-solution-stacks (may be useful)</span></p><h3 class="c1"><a name="h.w1opupd5ilri"></a><span>Create your RDS</span></h3><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><h3 class="c1"><a name="h.w7g95l63tin"></a><span>Terminate your environment</span></h3><a href="#" name="71a6ab8cee2392b09c09b14a22b579121e83aeae"></a><a href="#" name="5"></a><table cellpadding="0" cellspacing="0" class="c8"><tbody><tr class="c19"><td class="c9"><p class="c1"><span>$ elastic-beanstalk-terminate-environment -e UAT-environment</span></p></td></tr></tbody></table><p class="c1 c3"><span></span></p><h3 class="c1"><a name="h.c11y3td4qqi"></a><span>Delete your environment</span></h3><a href="#" name="c79d0f30e35aa5634d3731d51cf73e07571c802a"></a><a href="#" name="6"></a><table cellpadding="0" cellspacing="0" class="c8"><tbody><tr class="c19"><td class="c9"><p class="c1"><span>$ elastic-beanstalk-delete-environment-configuration -a GEG-WorkshopApplication -e UAT-environment</span></p></td></tr></tbody></table><p class="c1 c3"><span></span></p><h3 class="c1"><a name="h.ctddoeui2bjm"></a><span>Delete your application</span></h3><a href="#" name="d3b1b052ebb1714dde9911861eccbc77c11692c3"></a><a href="#" name="7"></a><table cellpadding="0" cellspacing="0" class="c8"><tbody><tr class="c19"><td class="c9"><p class="c1"><span>$ elastic-beanstalk-delete-application -a GEG-WorkshopApplication</span></p></td></tr></tbody></table><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><p class="c1 c3"><span></span></p><h1 class="c1"><a name="h.map0mpz4dp22"></a><span>Part 3 - </span><span>Blue/Green Deployment</span></h1><p class="c1"><span class="c22">One of the challenges with automating deployment is the cut-over itself, taking software from the final stage of testing to live production. You usually need to do this quickly in order to minimize downtime.</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="184" src="images/image26.png" width="647"></p><h2 class="c1"><a name="h.cwzar5a9hujl"></a><span class="c22">The blue-green deployment approach does this by ensuring you have two production environments, as identical as possible. At any time one of them, let&#39;s say blue for the example, is live. As you prepare a new release of your software you do your final stage of testing in the green environment. Once the software is working in the green environment, you switch the router so that all incoming requests go to the green environment - the blue one is now idle.</span></h2><h2 class="c1"><a name="h.a95rdu26denp"></a><span>Saving your PRD environment configuration settings</span></h2><p class="c1"><img height="302" src="images/image38.png" width="643"></p><p class="c1 c3"><span></span></p><p class="c1"><span>Below the application selection drop-down list, click the </span><span class="c4">Actions</span><span>&nbsp;drop-down list for your application environment in the application&#39;s Environments list and select </span><span class="c4">Save Configuration</span><span>.</span></p><p class="c1 c3"><span></span></p><p class="c1 c16"><img height="325" src="images/image46.png" width="674"></p><p class="c1 c3 c16"><span></span></p><p class="c1"><span>In the </span><span class="c4">Configuration Name</span><span>&nbsp;field type </span><span class="c4">petclinic-configuration-{{page.groupId}}</span><span>&nbsp;and click </span><span class="c4">Save Config</span><span>.</span></p><p class="c1 c3"><span></span></p><p class="c1 c16"><img height="175" src="images/image15.png" width="384"></p><h2 class="c1"><a name="h.yg784ymilwry"></a><span>Upload the new application version</span></h2><p class="c1"><span>Go to the </span><span class="c4">Versions</span><span>&nbsp;tab, and click </span><span class="c4">Upload New Version</span><span>. In the pop-up windows, indicate </span><span class="c4">Second Release</span><span>&nbsp;in the </span><span class="c4">Version Label</span><span>&nbsp;field and upload the new version of your application.</span></p><p class="c1 c3"><span></span></p><p class="c1"><span>Do not forget to check the deployment option </span><span class="c4">Upload but do not deploy to any environment</span><span>, and then click </span><span class="c4">Upload New Version</span><span>.</span></p><p class="c1 c3"><span></span></p><p class="c1 c16"><img height="320" src="images/image32.png" width="671"></p><p class="c1 c3"><span class="c4"></span></p><p class="c1"><span>Now, verify that your new application version has been correctly uploaded.</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="120" src="images/image18.png" width="556"></p><h2 class="c1"><a name="h.9vs3tfaz8kwa"></a><span>Create a new QA environment</span></h2><p class="c1"><span>Click </span><span class="c4">Launch New Environment</span><span>&nbsp;button and fill the form with </span><span class="c4">petclinic-{{page.groupId}}-qa</span><span>&nbsp;as environment name. Indicate that you want to use an existing application version and select </span><span class="c4">Second Release.</span></p><p class="c1 c3"><span class="c4"></span></p><p class="c1"><span>In the Container Type, indicate </span><span class="c4">64bit Amazon Linux running Tomcat 7</span><span>&nbsp;and check the </span><span class="c4">Create an RDS DB Instance with this environment</span><span>&nbsp;option.</span></p><p class="c1 c3"><span></span></p><p class="c1"><span>Then click </span><span class="c4">Continue.</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="326" src="images/image24.png" width="681"></p><p class="c1 c3"><span></span></p><p class="c1"><span>On the next step, indicate that you want to </span><span class="c4">Load a Saved Configuration</span><span>&nbsp;by selecting the </span><span class="c4">petclinic-configuration-{{page.groupId}}</span><span>&nbsp;configuration, and click </span><span class="c4">Continue</span><span>.</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="326" src="images/image43.png" width="460"></p><p class="c1 c3"><span></span></p><p class="c1"><span>Concerning the </span><span class="c4">RDS DB Instance</span><span>, indicate that you want to create it from a snaphot and select </span><span class="c4">petclinic-database-created-snapshot</span><span>.</span></p><p class="c1 c3"><span></span></p><p class="c1"><span>Fill </span><span class="c4">rootroot</span><span>&nbsp;as master password, and click </span><span class="c4">Continue</span><span>.</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="389" src="images/image02.png" width="461"></p><p class="c1 c3"><span></span></p><p class="c1"><span>Verify your environment information and click </span><span class="c4">Finish</span><span>.</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="358" src="images/image06.png" width="464"></p><h2 class="c1"><a name="h.b3fpwc2c9p72"></a><span>Deploy the new application version with Zero Downtime</span></h2><p class="c1"><span>Now, you have 2 environments:</span></p><ol class="c11" start="1"><li class="c6 c1 c10"><span>QA (Blue Slice)</span></li><li class="c6 c1 c10"><span>PRD (Green Slice)</span></li></ol><p class="c1 c3"><span></span></p><p class="c1"><span>Make sure that your new environment is in the Green and Ready state.</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="326" src="images/image44.png" width="681"></p><p class="c1 c3"><span></span></p><p class="c1"><span>Click the </span><span class="c4">Actions</span><span>&nbsp;drop-down list on your live production application environment and select </span><span class="c4">Swap Environment URL</span><span>.</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="246" src="images/image23.png" width="682"></p><p class="c1 c3"><span></span></p><p class="c1"><span>In the </span><span class="c4">Swap Environment URL</span><span>&nbsp;window, select </span><span class="c4">petclinic-{{page.groupId}}-qa</span><span>&nbsp;from the </span><span class="c4">Environment Name</span><span>&nbsp;pull-down menu, and then click on </span><span class="c4">Swap URL</span><span>.</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="302" src="images/image01.png" width="461"></p><p class="c1 c3"><span></span></p><p class="c1"><span>Now the new release version of your application is accessible through the URL of your live production environment: </span><span class="c4">http://petclinic-{{page.groupId}}.elasticbeanstalk.com/</span><span>.</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="341" src="images/image39.png" width="681"></p><p class="c1 c3"><span></span></p><p class="c1"><span>Enjoy!</span></p><p class="c1 c3"><span></span></p><p class="c1"><img height="506" src="images/image28.png" width="640"></p>
