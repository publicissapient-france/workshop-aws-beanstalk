---
layout: main
---

<style type="text/css">ol{margin:0;padding:0}.c10{vertical-align:top;width:468pt;border-style:solid;background-color:#cccccc;border-color:#000000;border-width:1pt;padding:5pt 5pt 5pt 5pt}.c12{vertical-align:top;width:468pt;border-style:solid;border-color:#000000;border-width:1pt;padding:5pt 5pt 5pt 5pt}.c18{list-style-type:disc;margin:0;padding:0}.c14{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c6{color:inherit;text-decoration:inherit}.c4{color:#1155cc;text-decoration:underline}.c1{height:11pt}.c0{direction:ltr}.c16{border-collapse:collapse}.c20{text-decoration:underline}.c17{font-style:italic}.c15{text-align:center}.c9{margin-left:18pt}.c5{line-height:1.0}.c2{margin-left:36pt}.c13{font-weight:bold}.c7{padding-left:0pt}.c3{margin-left:54pt}.c8{background-color:#d9d9d9}.c21{color:#ff0000}.c19{height:0pt}.c11{height:12pt}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:10pt;font-family:"Arial";padding-bottom:2pt}</style>
<span></span></p><p class="c0 c9"><span class="c4"><a class="c6" href="#h.6cwv4882r8jw">Deploy an application with &ldquo;Elastic Beanstalk&rdquo;</a></span></p><p class="c0 c2"><span class="c4"><a class="c6" href="#h.z9jik6tm9217">Connect to AWS console</a></span></p><p class="c0 c2"><span class="c4"><a class="c6" href="#h.wqqlorlisphh">Create a new sample application</a></span></p><p class="c0 c3"><span class="c4"><a class="c6" href="#h.585r3gk5nn3r">Application Details</a></span></p><p class="c0 c3"><span class="c4"><a class="c6" href="#h.ehxc748ma7ut">Environment Details (Option A : create a DB Instance with the environment)</a></span></p><p class="c0 c3"><span class="c4"><a class="c6" href="#h.v6v5ysgci6qz">Configuration Details (Option A : Create the DB from a snapshot)</a></span></p><p class="c0 c3"><span class="c4"><a class="c6" href="#h.p4oik7rglm9d">Test sample application</a></span></p><p class="c0 c2"><span class="c4"><a class="c6" href="#h.sk9s7lt50pi7">Deploy PetClinic application in place of the sample application</a></span></p><p class="c0 c3"><span class="c4"><a class="c6" href="#h.l1qkrd74dlrp">Upload the Petclinic war file</a></span></p><p class="c0 c3"><span class="c4"><a class="c6" href="#h.7xfsqqrlwcbe">Providing url to the MySQL instance</a></span></p><p class="c0 c2"><span class="c4"><a class="c6" href="#h.gu96gf1l6g8u">Deploying Petclinic when we do not provide a RDS DB snapshot</a></span></p><p class="c0 c9"><span class="c4"><a class="c6" href="#h.zg3zc1e7x3nf">SDK CLI installation</a></span></p><p class="c0 c9"><span class="c4"><a class="c6" href="#h.afexvcefyprz">Deploy a new application</a></span></p><p class="c0 c9"><span class="c4"><a class="c6" href="#h.ywlgvypzlijw">Saving your QA environment configuration settings</a></span></p><p class="c1 c0"><span></span></p><h1 class="c0"><a name="h.6cwv4882r8jw"></a><span>Deploy an application with &ldquo;Elastic Beanstalk&rdquo;</span></h1><p class="c0"><span>Pr&eacute;requis: </span></p><p class="c0"><span>JDK6</span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c0"><span></span></p><h2 class="c0"><a name="h.z9jik6tm9217"></a><span>Connect to AWS console</span></h2><p class="c0"><span>The AWS console is here: </span><span class="c4"><a class="c6" href="https://xebia-france.signin.aws.amazon.com/console">https://xebia-france.signin.aws.amazon.com/console</a></span></p><p class="c1 c0"><span></span></p><p class="c0"><span>The login and password are the one provided on the workshop sheet on the table.</span></p><p class="c1 c0"><span></span></p><h2 class="c0"><a name="h.wqqlorlisphh"></a><span>Create a new sample application</span></h2><p class="c0"><span>Go to Amazon Console home page and click on &ldquo;Elastic Beanstalk&rdquo; :</span></p><p class="c0"><img height="413" src="../images/image05.png" width="677"></p><p class="c1 c0"><span></span></p><h3 class="c0"><a name="h.585r3gk5nn3r"></a><span>Application Details</span></h3><p class="c0"><span>Click on &ldquo;Create New Application&rdquo;.</span></p><p class="c0"><span>Then in the modal window provide the &ldquo;Application-Name&rdquo; type &lsquo;petclinc-{{ page.groupId }}&rsquo; </span></p><p class="c0"><span>Select &ldquo;Container Type&rdquo; : &ldquo;64bit Amazon Linux running Tomcat 7&rdquo;</span></p><p class="c0"><span>Select &ldquo;Application Source&rdquo; : &ldquo;Use the Sample Application&rdquo;.</span></p><p class="c0"><span>Click on &ldquo;Continue&rdquo;</span></p><p class="c0"><img height="389" src="../images/image12.png" width="697"></p><p class="c1 c0"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c0"><span></span></p><h3 class="c0"><a name="h.ehxc748ma7ut"></a><span>Environment Details (Option A : create a DB Instance with the environment)</span></h3><p class="c0"><span>Check &nbsp;&ldquo;Launch a new environment running this application&rdquo; and &ldquo;Create an RDS DB Instance with this environment&rdquo;.</span></p><p class="c0"><span>Provide the &ldquo;Environment Name&rdquo; : you can use the application name you provided in the previous step adding &ldquo;-Env&rdquo; to the end.</span></p><p class="c0"><span>Provide an environment url (this will be your application url).</span></p><p class="c1 c0"><span></span></p><p class="c0"><img height="441" src="../images/image30.png" width="635"></p><p class="c1 c0"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c0"><span></span></p><h3 class="c0"><a name="h.v6v5ysgci6qz"></a><span>Configuration Details (Option A : Create the DB from a snapshot)</span></h3><p class="c1 c0"><span></span></p><p class="c0"><img height="503" src="../images/image26.png" width="590"></p><p class="c0 c1"><span></span></p><p class="c0"><img height="409" src="../images/image28.png" width="482"></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c0"><img height="375" src="../images/image23.png" width="697"></p><p class="c1 c0"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c0"><span></span></p><h3 class="c0"><a name="h.p4oik7rglm9d"></a><span>Test sample application</span></h3><p class="c0"><span>Once the Beanstalk test application environment is up then you should have the following screen</span></p><p class="c0"><img height="297" src="../images/image02.png" width="660"></p><p class="c0"><span>Click on the &ldquo;View Running Version&rdquo; to see your first application deployed on Beanstalk:</span></p><p class="c0"><img height="403" src="../images/image14.png" width="640"></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><h2 class="c0"><a name="h.sk9s7lt50pi7"></a><span>Deploy PetClinic application in place of the sample application</span></h2><h3 class="c0"><a name="h.l1qkrd74dlrp"></a><span>Upload the Petclinic war file</span></h3><p class="c0"><img height="485" src="../images/image07.png" width="668"></p><p class="c1 c0"><span></span></p><p class="c0"><span>Testing the PetClinic application</span></p><p class="c0"><span>Well it doesn&rsquo;t work well right now &hellip;</span></p><p class="c0"><span>We should take a look to the logs files</span></p><p class="c0"><img></p><p class="c0"><span>Looking a the detail to the log we ca find out that the database is not found.</span></p><p class="c0"><span>We need to provide the url of the RDS MySQL database instance to our PetClinic application.</span></p><p class="c0"><img height="296" src="../images/image27.png" width="769"></p><p class="c1 c0"><span></span></p><h3 class="c0 c11"><a name="h.23ltab9fxfi1"></a></h3><hr style="page-break-before:always;display:none;"><h3 class="c0 c11"><a name="h.wr52sn91che9"></a></h3><h3 class="c0"><a name="h.7xfsqqrlwcbe"></a><span>Providing url to the MySQL instance</span></h3><p class="c0"><span>Before providing the url to our application we need to know the DB Endpoint url. </span></p><p class="c0"><span>Select the url and copy it in the clipboard.</span></p><p class="c0"><img height="434" src="../images/image04.png" width="685"></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c0"><span></span></p><p class="c0"><span>Provide the jdbc connection string. For example:</span></p><p class="c0"><span>jdbc:mysql://</span><span class="c17 c13">aar34zgkhl2dcm.cccb4ickfoh9.eu-west-1.rds.amazonaws.com</span><span>:3306/petclinic?user=root&amp;password=rootroot</span></p><p class="c0"><span>Obviously for your own petclinic application you should set your own DB Endpoint with the one you&rsquo;ve copied previously.</span></p><p class="c0"><span>When you&rsquo;ve provided the url in the JDBC_CONNECTION_STRING environment variable, click on &ldquo;Apply Changes&rdquo;.</span></p><p class="c0"><img height="449" src="../images/image15.png" width="555"></p><p class="c1 c0"><span></span></p><p class="c0"><span>When the environment has finished restarted, check again the petclinic application. </span></p><hr style="page-break-before:always;display:none;"><p class="c1 c0"><span></span></p><h2 class="c0"><a name="h.gu96gf1l6g8u"></a><span>Deploying Petclinic when we do not provide a RDS DB snapshot</span></h2><p class="c0"><span>Now we are going to deploy the petclinic application with a mysql database.</span></p><p class="c0"><img height="296" src="../images/image17.png" width="660"></p><p class="c0"><span>Click on &ldquo;Edit Configuration&rdquo; and select &ldquo;Database&rdquo; Tab</span></p><p class="c0"><img height="546" src="../images/image03.png" width="531"></p><p class="c1 c0"><span></span></p><p class="c0"><span>Check &ldquo;Create an RDS DB Instance with this environment&rdquo;</span></p><p class="c0"><span>Provide the following configuration:</span></p><p class="c0"><span>Allocated Storage: 5 GB</span></p><p class="c0"><span>Master Username: root</span></p><p class="c0"><span>Master Password: rootroot</span></p><p class="c0"><img height="576" src="../images/image10.png" width="561"></p><p class="c0"><span>Once done click on &ldquo;Apply Changes&rdquo;.</span></p><p class="c1 c0"><span></span></p><p class="c0"><span>When the RDS DB Instance is up click again on &ldquo;Edit Configuration&rdquo; and select the &ldquo;Database&rdquo; tab:</span></p><p class="c0"><img height="518" src="../images/image06.png" width="545"></p><p class="c1 c0"><span></span></p><p class="c0"><span>Remember the &ldquo;DB Endpoint&rdquo;.</span></p><p class="c0"><span>Click Cancel to close &ldquo;Edit Configuration&rdquo; modal window.</span></p><p class="c1 c0"><span></span></p><p class="c0"><span>Now go to RDS management console. Click on &ldquo;Console&rdquo; and choose &ldquo;RDS&rdquo;:</span></p><p class="c1 c0"><span></span></p><p class="c0"><img height="250" src="../images/image09.png" width="300"></p><p class="c1 c0"><span></span></p><p class="c0"><span>In the RDS Console click on &ldquo;DB Instances</span></p><p class="c0"><img height="263" src="../images/image11.png" width="676"></p><p class="c1 c0"><span></span></p><p class="c0"><span>This will display the current active DB instances:</span></p><p class="c0"><img height="122" src="../images/image29.png" width="673"></p><p class="c0"><span>If there is more than one you will need to use the name of the &ldquo;DB Endpoint&rdquo; you previously set aside and you will get the name of the &ldquo;Security Group&rdquo; linked to the DB Instance.</span></p><p class="c1 c0"><span></span></p><p class="c0"><img height="378" src="../images/image00.png" width="649"></p><p class="c1 c0"><span></span></p><p class="c0"><img height="251" src="../images/image20.png" width="708"></p><p class="c1 c0"><span></span></p><p class="c0"><img height="264" src="../images/image08.png" width="693"></p><p class="c1 c0"><span></span></p><p class="c0"><span>With your mysql client from your computer connect to the RDS Database :</span></p><p class="c0"><img height="336" src="../images/image21.png" width="559"></p><p class="c1 c0"><span></span></p><p class="c0"><span>One you are connected to the distant RDS MySQL Instance you can create the &ldquo;petclinic&rdquo; database:</span></p><p class="c1 c0"><span></span></p><p class="c0"><span>create database petclinic;</span></p><p class="c1 c0"><span></span></p><p class="c0"><span>Now that we have created the database in the RDS MySQL Instance we have to close the access we previously opened. </span></p><p class="c0"><span>To do that we remove &ldquo;CIDR/IP&rdquo; &ldquo;Connection Type&rdquo; by clicking on the &ldquo;Remove&rdquo; button.</span></p><p class="c0"><span>Finally click on &ldquo;Refresh Security groups&rdquo;</span></p><p class="c1 c0"><span></span></p><p class="c0"><img height="264" src="../images/image16.png" width="693"></p><p class="c1 c0"><span></span></p><p class="c0"><span>Return on the Beanstalk instance:</span></p><p class="c0"><img height="261" src="../images/image25.png" width="694"></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c0"><span>We are going to provide the JDBC url to our application using a system property named JDBC_CONNECTION_STRING.</span></p><p class="c0"><span>The url should be of the form:</span></p><p class="c0"><span>jdbc:mysql://</span><span class="c13">aa1eh8jwqqq5ght.cccb4ickfoh9.eu-west-1.rds.amazonaws.com</span><span>:3306/petclinic?user=root&amp;password=rootroot</span></p><p class="c0"><span>The bold string should be replaced by </span><span class="c20">your own</span><span>&nbsp;RDS mySQL instance.</span></p><p class="c1 c0"><span></span></p><p class="c0"><img height="384" src="../images/image01.png" width="692"></p><p class="c1 c0"><span></span></p><p class="c0"><span>Beanstalk is going to restart the tomcat server with the system property properly set.</span></p><p class="c0"><span>Once restart is done select the &ldquo;Versions&rdquo; tab, </span></p><p class="c0"><span>Click on &ldquo;Upload New Version&rdquo; and </span></p><ol class="c18" start="1"><li class="c0 c2 c7"><span>set the form with version label, </span></li><li class="c0 c2 c7"><span>upload the war file, </span></li><li class="c0 c2 c7"><span>select &ldquo;Deploy to an existing environment after upload&rdquo;, </span></li><li class="c0 c2 c7"><span>choose &ldquo;Default-Environment&rdquo;, </span></li><li class="c0 c2 c7"><span>validate by clicking on &ldquo;Apply Changes&rdquo;</span></li></ol><p class="c1 c0"><span></span></p><p class="c0"><span>Now Tomcat instance is restarted.</span></p><p class="c0"><img height="426" src="../images/image24.png" width="697"></p><p class="c1 c0"><span></span></p><p class="c0"><span>When Tomcat is up with our new war file click on &ldquo;View Running Version&rdquo; and use the petclinic web app to check database access works fine.</span></p><p class="c0"><img height="345" src="../images/image13.png" width="697"></p><p class="c1 c0"><span></span></p><p class="c0"><img height="450" src="../images/image22.png" width="643"></p><p class="c1 c0"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c0"><span></span></p><h1 class="c0"><a name="h.zg3zc1e7x3nf"></a><span>SDK CLI installation</span></h1><p class="c0"><span>Download Elastic Beanstalk Command Line Tool at URL </span><span class="c4"><a class="c6" href="http://aws.amazon.com/code/6752709412171743">http://aws.amazon.com/code/6752709412171743</a></span></p><p class="c1 c0"><span></span></p><p class="c0"><span>Unzip the archive in the &lt;workshop_directory&gt;.</span></p><p class="c0"><span>Add the directory &lt;workshop_directory&gt;/AWS-ElasticBeanstalk-CLI-2.2/api/bin to your PATH.</span></p><p class="c0"><span>In your &lt;workshop_directory&gt; create a file named credentials and write the following lines:</span></p><p class="c0"><span>AWSAccessKeyId=</span><span class="c17">Write your AWS access ID</span><span><br>AWSSecretKey=</span><span class="c17">Write your AWS secret key</span></p><p class="c0"><span>(check your mails for the values)</span></p><p class="c1 c0"><span></span></p><p class="c0"><span>Add the environment variables:</span></p><p class="c0"><span>export AWS_CREDENTIAL_FILE=&lt;workshop_directory&gt;/credentials</span></p><p class="c0"><span>export ELASTICBEANSTALK_URL=https://elasticbeanstalk.eu-west-1.amazonaws.com</span></p><p class="c1 c0"><span></span></p><p class="c0"><span>Si erreurs avec JSon lors de l&rsquo;&eacute;xecution des commandes:</span></p><p class="c1 c0"><span class="c8"></span></p><a href="#" name="6820246b598c148fd7634922a5578b76730d0abe"></a><a href="#" name="0"></a><table cellpadding="0" cellspacing="0" class="c16"><tbody><tr><td class="c8 c12"><p class="c0 c5"><span class="c8">$sudo gem install json</span></p></td></tr></tbody></table><p class="c1 c0"><span class="c8"></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c0"><span>source:</span></p><p class="c0"><span class="c4"><a class="c6" href="http://docs.amazonwebservices.com/elasticbeanstalk/latest/dg/usingCLI.html">http://docs.amazonwebservices.com/elasticbeanstalk/latest/dg/usingCLI.html</a></span></p><p class="c1 c0"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c1 c0"><span></span></p><h1 class="c0"><a name="h.kcmccid8htd3"></a><span>Deploy a new application</span></h1><h3 class="c0"><a name="h.8apxffk384ms"></a><span>Create a new application slot</span></h3><p class="c1 c0"><span></span></p><a href="#" name="57f7db5caa03b14d46e2d784f80528f8f2542b83"></a><a href="#" name="1"></a><table cellpadding="0" cellspacing="0" class="c16"><tbody><tr class="c19"><td class="c10"><p class="c0 c5"><span>$ elastic-beanstalk-create-application -a &#39;GEG-WorkshopApplication&#39;</span></p></td></tr></tbody></table><h3 class="c0"><a name="h.7b6tawoffmy6"></a><span>Deploy on your new slot, your application stored in a S3 bucket</span></h3><a href="#" name="bcf7692c27e1dd18a474eb80a4d35cf223cc3245"></a><a href="#" name="2"></a><table cellpadding="0" cellspacing="0" class="c16"><tbody><tr><td class="c10"><p class="c0 c5"><span>$ elastic-beanstalk-create-application-version -a GEG-WorkshopApplication -l &#39;V1&#39; -d &#39;Test CLI&#39; -s elasticbeanstalk-eu-west-1-010154155802/2012322ige-petclinic.war</span></p></td></tr></tbody></table><p class="c1 c0"><span></span></p><p class="c0"><span>=&gt; Your application must be uploaded on a S3 bucket before you can launched it with beanstalk.</span></p><h3 class="c0"><a name="h.yax76l4hkcea"></a><span>Set your options</span></h3><p class="c0"><span>Create a file to set the options of your next environment.</span></p><p class="c0"><span>To see the avalaible options, follow this url: http://docs.amazonwebservices.com/elasticbeanstalk/latest/dg/command-options.html</span></p><h3 class="c0"><a name="h.3i0ayrahs952"></a><span>Create your environment</span></h3><p class="c1 c0"><span></span></p><h3 class="c0"><a name="h.hgtg3sbnwr5p"></a><span>Create your RDS</span></h3><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p><p class="c0 title"><a name="h.updb1niyl2mp"></a><span>#3 Blue/Green Deployment</span></p><h1 class="c0"><a name="h.ywlgvypzlijw"></a><span>Saving your QA environment configuration settings</span></h1><ol class="c18" start="1"><li class="c0 c2 c7"><span>Below the application selection drop-down list, click the Actions drop-down list for your application environment in the application&#39;s Environments list and select Save Configuration:</span></li></ol><p class="c1 c0"><span></span></p><p class="c0 c15"><img height="389" src="../images/image18.png" width="609"></p><p class="c1 c0 c15"><span></span></p><ol class="c18" start="1"><li class="c0 c2 c7"><span>In the configuration name field type &ldquo;environment_QA_Team_{{ page.groupId}}&rdquo; and click Save Config:</span></li></ol><p class="c1 c0"><span></span></p><p class="c0 c15"><img height="202" src="../images/image19.png" width="481"></p><p class="c1 c0"><span></span></p><p class="c1 c0"><span></span></p>
